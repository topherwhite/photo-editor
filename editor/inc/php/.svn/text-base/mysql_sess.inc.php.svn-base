<?php$sqlserver = $var['creds']['mysql']['srvr'];$sqlusername = $var['creds']['mysql']['user'];$sqluserpswd = $var['creds']['mysql']['pswd'];$databasename = "sessions";function showerror(){	die ("Error ".mysql_errno()." : ".mysql_error());}function mysqlclean($array,$index,$maxlength,$connection){	if (isset($array["{$index}"]))	{	$input = substr($array["{$index}"],0,$maxlength);		$input = mysql_real_escape_string($input,$connection);		return ($input);	}	return NULL;}function GetMicroTime(){	$mtime = explode(" ",microtime());	return($mtime[1]+$mtime[0]);}function sessionOpen($db,$tble){	global $connection;	global $sess_tble;	global $srvr;	global $user;	global $pswd;	if (!($connection = @mysql_connect($srvr,$user,$pswd)))		showerror();	if (!(mysql_select_db($db,$connection)))					showerror();	$sess_tble = $tble;	return true;}function sessionRead($sess_id){	global $connection;	global $sess_tble;	$search_query = "SELECT * FROM {$sess_tble} WHERE session_id='{$sess_id}'";	if (!($result = @mysql_query($search_query,$connection)))	showerror();	if (mysql_num_rows($result) == 0)							return "";	else	{	$row = mysql_fetch_array($result);		return $row["session_variable"];	}}function sessionWrite($sess_id,$val){	global $connection;	global $sess_tble;	$time = getMicroTime();	$search_query = "SELECT session_id FROM {$sess_tble} WHERE session_id='{$sess_id}'";	if (!($result = @mysql_query($search_query,$connection)))		showerror();	if (mysql_num_rows($result) == 0)	{	$insert_query = "INSERT INTO {$sess_tble} SET session_id='{$sess_id}', session_variable='{$val}', last_accessed='{$time}'";		if (!(mysql_query($insert_query,$connection)))				showerror();	}	else	{	$update_query = "UPDATE {$sess_tble} SET session_variable='{$val}', last_accessed={$time} WHERE session_id='{$sess_id}'";		if (!(mysql_query($update_query,$connection)))				showerror();}	}function sessionClose(){	return true;}function sessionDestroy($sess_id){	global $connection;	global $sess_tble;	$delete_query = "DELETE FROM {$sess_tble} WHERE session_id = '{$sess_id}'";	if (!(mysql_query($delete_query,$connection)))					showerror();	return true;}function sessionGC($max_lifetime){	global $connection;	global $sess_tble;	$current_time = getMicroTime();	$delete_query = "DELETE FROM {$sess_tble} WHERE last_accessed < ({$current_time}-{$max_lifetime})";	if (!(mysql_query($delete_query,$connection)))					showerror();	return true;}session_set_save_handler("sessionOpen","sessionClose","sessionRead","sessionWrite","sessionDestroy","sessionGC");?>